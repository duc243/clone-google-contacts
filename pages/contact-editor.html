<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact Page</title>
    <link
      href="../assets/vendors/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link href="../assets/css/index.css" rel="stylesheet" />
  </head>
  <body id="contactEditorPage">
    <div id="headerPlaceholder"></div>
    <div id="contentContainer">
      <div id="sideBarPlaceholder"></div>

      <form id="content" action="javascript:void(0)" onsubmit="onFormSubmit(event)">
        <div id="contactEditorHeader">
          <div class="avatar addIconButton">
            <i class="fa fa-user" aria-hidden="true"></i>

            <button>
              <input
                type="file"
                id="avatarFilePickerInput"
                onchange="onFileChange(this.files)"
              />
              <label for="avatarFilePickerInput">
                <i class="fa fa-plus" aria-hidden="true"></i>
              </label>
            </button>
            <div class="nameSection">
              <div class="name"></div>
              <div class="labelsSection">
                <div class="labels"></div>
                <div
                  class="labelsPickerButton"
                  onclick="showDialog(document.querySelector('#labelPickerDialog'))"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="25px" height="25px" viewBox="0 0 256 256">
                          <path fill="currentColor" d="M224 128a8 8 0 0 1-8 8h-80v80a8 8 0 0 1-16 0v-80H40a8 8 0 0 1 0-16h80V40a8 8 0 0 1 16 0v80h80a8 8 0 0 1 8 8" />
                      </svg>
                  Libellé
                </div>
              </div>
            </div>
          </div>
          
          
          <div class="actionSection">
            <button type="submit" class="editButton primary-button button">Save</button>
          </div>
        </div>
        <div
          id="contactEditorContent"
          action="javascript:void(0)"
          onsubmit="FormSubmit(event)"
        >
          <div class="column">
            <div class="row">
              <div class="iconColumn">
                <i class="fa fa-user" aria-hidden="true"></i>
              </div>
              <div class="inputColumn">
                <input name="firstName" type="text" placeholder="First Name" />
              </div>
              <div
                onclick="this.closest('.row').querySelector('input').value = ''"
                class="crossIconColumn"
              >
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
            </div>
            <div class="row">
              <div class="iconColumn">
                <i class="fa fa-user" aria-hidden="true"></i>
              </div>
              <div class="inputColumn">
                <input name="lastName" type="text" placeholder="Last Name" />
              </div>
              <div
                onclick="this.closest('.row').querySelector('input').value = ''"
                class="crossIconColumn"
              >
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
            </div>
          </div>
          
          <div class="column">
            <div class="row">
              <div class="iconColumn">
                <i class="fa fa-building-o" aria-hidden="true"></i>
              </div>
              <div class="inputColumn">
                <input name="entreprise" type="text" placeholder="Entreprise" />
              </div>
              <div
                onclick="this.closest('.row').querySelector('input').value = ''"
                class="crossIconColumn"
              >
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
            </div>
            <div class="row">
              <div class="iconColumn">
                <i class="fa fa-building-o" aria-hidden="true"></i>
              </div>
              <div class="inputColumn">
                <input name="fonction" type="text" placeholder="Fonction" />
              </div>
              <div
                onclick="this.closest('.row').querySelector('input').value = ''"
                class="crossIconColumn"
              >
                <i class="fa fa-times" aria-hidden="true"></i>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="iconColumn">
              <i class="fa fa-envelope-o" aria-hidden="true"></i>
            </div>
            <div class="inputColumn">
              <input name="email" type="email" placeholder="Email" />
            </div>
            <div
              onclick="this.closest('.row').querySelector('input').value = ''"
              class="crossIconColumn"
            >
              <i class="fa fa-times" aria-hidden="true"></i>
            </div>
          </div>
          
          <div class="row">
            <svg xmlns="http://www.w3.org/2000/svg" width="25px" height="25px" viewBox="0 0 256 256">
                    <path fill="currentColor" d="M224 128a8 8 0 0 1-8 8h-80v80a8 8 0 0 1-16 0v-80H40a8 8 0 0 1 0-16h80V40a8 8 0 0 1 16 0v80h80a8 8 0 0 1 8 8" />
                </svg>
            Ajouter une adresse email 
          </div>

          <div class="row">
            <div class="iconColumn">
              <i class="fa fa-phone" aria-hidden="true"></i>
            </div>
            <div class="inputColumn">
              <input name="phone" type="text" placeholder="Phone" />
            </div>
            <div
              onclick="this.closest('.row').querySelector('input').value = ''"
              class="crossIconColumn"
            >
              <i class="fa fa-times" aria-hidden="true"></i>
            </div>
          </div>
          
          <div class="row">
            <svg xmlns="http://www.w3.org/2000/svg" width="25px" height="25px" viewBox="0 0 256 256">
                    <path fill="currentColor" d="M224 128a8 8 0 0 1-8 8h-80v80a8 8 0 0 1-16 0v-80H40a8 8 0 0 1 0-16h80V40a8 8 0 0 1 16 0v80h80a8 8 0 0 1 8 8" />
                </svg>
            Ajouter une adresse email 
          </div>
        <a href="#">Plus</a>
        </div>
      </form>

    <div class="dialog" id="labelPickerDialog">
      <div
        class="dialogOverlay"
        onclick="closeDialog(this.closest('.dialog'))"
      ></div>
      <dive class="dialogContentContainer">
        <div class="dialogTitle">Pick a label</div>
        <div class="dialogContent">
          <div class="label" onclick="closeDialog(this.closest('.dialog'))">
            <div class="iconSection">
              <i class="fa fa-tag" aria-hidden="true"></i>
            </div>
            <div class="text">Label 1</div>
            <div class="selectionIcon primary-color">
              <i class="fa fa-check" aria-hidden="true"></i>
            </div>
          </div>

          <div class="label" onclick="closeDialog(this.closest('.dialog'))">
            <div class="iconSection">
              <i class="fa fa-tag" aria-hidden="true"></i>
            </div>
            <div class="text">Label 1</div>
            <div class="selectionIcon primary-color">
              <i class="fa fa-check" aria-hidden="true"></i>
            </div>
          </div>

          <div class="label" onclick="closeDialog(this.closest('.dialog'))">
            <div class="iconSection">
              <i class="fa fa-tag" aria-hidden="true"></i>
            </div>
            <div class="text">Label 1</div>
            <div class="selectionIcon primary-color">
              <i class="fa fa-check" aria-hidden="true"></i>
            </div>
          </div>
        </div>
        <div class="dialogFooter">
          <button>+ Create label</button>
          <button>Apply</button>
        </div>
      </dive>
    </div>

    <script src="../assets/js/common.js"></script>

    <script>

        const params = new URLSearchParams(location.search);
        contactId = params.get("id");
      if(contactId){
        loadContact();
      }

      function onFileChange(files) {
        let file = files.length > 0 ? files[0] : null;
        getBase64FromFile(file).then((base64) => {
          let avatar = document.querySelector("#contactEditorHeader .avatar");

          avatar.style.backgroundImage = `url(${base64})`;
          avatar.classList.add("imagePicked");
        });
      }



      async function onFormSubmit(e) {
        e.preventDefault();

        let formElement = e.target;
        let formData = new FormData(formElement);
        let data = {
          id: crypto.randomUUID(),
          firstName: formData.get('firstName'),
          lastName: formData.get('lastName'),
          entreprise: formData.get('entreprise'),
          fonction: formData.get('fonction'),
          email: formData.get('email'),
          phone: formData.get('phone')
        };


       save(data, contactId?'update':'create');
        
        console.log(e);
      }

      async function save(data, action){
        if(action =='update') data.id = contactId;

        contacts.push(data);

        window.location = '/';  
        
      }


      function tableBody() {
        let tableBody = document.querySelector('.tableBody');
        console.log(tableBody);
      }
      
   
      // Ajouter le gestionnaire d'événements à la soumission du formulaire
      //document.getElementById('content').addEventListener('submit', onFormSubmit);

      

      // async function loadContact(){
          
      //   let contact = await getContact(contactId);

      //   let emailInput = document.querySelector(`[name="email"]`);
      //   let fullNameInput = document.querySelector(`[name="fullName"]`);
      //   let phoneInput = document.querySelector(`[name="phone"]`);
      //   let websiteInput = document.querySelector(`[name="website"]`);


      //   emailInput.value = contact.email;
      //   fullNameInput.value = contact.fullName;
      //   phoneInput.value = contact.phone;
      //   websiteInput.value = contact.website;

      // }
    </script>
    <script src="/assets/js/data.js"></script>
    <script src="/assets/js/common.js"></script>
  </body>
</html>
