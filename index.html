<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contacts App</title>
    <link
      href="assets/vendors/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link href="assets/css/index.css" rel="stylesheet" />
  </head>
  <body>
    <div id="headerPlaceholder"></div>
    <div id="contentContainer">
      <div id="sideBarPlaceholder"></div>

      <div id="content">
        <div class="table">
          <h1 class="tableTitle">
              Contacts <sup>(500)</sup>
            </h1>
          <div class="tableHead">
            <div class="column">Titre</div>
            <div class="column">Email</div>
            <div class="column">Numéro de téléphone</div>
            <div class="column">Fonction et Entreprise</div>
            <div class="column">Libellés</div>
            <!-- <div class="columnLogo">

              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 256">

                  <path fill="currentColor" d="M240 96v80a8 8 0 0 1-8 8h-32v32a8 8 0 0 1-8 8H64a8 8 0 0 1-8-8v-32H24a8 8 0 0 1-8-8V96c0-13.23 11.36-24 25.33-24H56V40a8 8 0 0 1 8-8h128a8 8 0 0 1 8 8v32h14.67C228.64 72 240 82.77 240 96M72 72h112V48H72Zm112 88H72v48h112Zm16-44a12 12 0 1 0-12 12a12 12 0 0 0 12-12" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M11 16V7.85l-2.6 2.6L7 9l5-5l5 5l-1.4 1.45l-2.6-2.6V16zm-5 4q-.825 0-1.412-.587T4 18v-3h2v3h12v-3h2v3q0 .825-.587 1.413T18 20z" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M12 3c-.825 0-1.5.675-1.5 1.5S11.175 6 12 6s1.5-.675 1.5-1.5S12.825 3 12 3m0 15c-.825 0-1.5.675-1.5 1.5S11.175 21 12 21s1.5-.675 1.5-1.5S12.825 18 12 18m0-7.5c-.825 0-1.5.675-1.5 1.5s.675 1.5 1.5 1.5s1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5" />
              </svg>
            </div> -->
        </div>
          

          <div class="actionsBar">
            <div class="buttons">
              <i class="fa fa-tags" aria-hidden="true"></i>
              <i
                class="fa fa-trash"
                onclick="deleteSelectedContacts()"
                aria-hidden="true"
              ></i>
            </div>
            <div class="rightSection">
              <div class="numberOfSelectedContacts"></div>
              selected
            </div>
          </div>

          <div class="tableBody"></div>
        </div>
      </div>
    </div>
    <script src="assets/js/common.js"></script>
    <script>
      


      


      // async function loadContacts() {
      //   let response = await fetch(`${backendBaseUrl}/contact`);
      //   let data = await response.json();

      //   contacts = data;
      //   console.log(contacts);
      //   renderContacts();
      // }

      function getSelectedContacts() {
        return contacts.filter((contact) => contact.selected);
      }

      async function deleteSelectedContacts(pSelectedContacts = undefined) {
        let selectedContacts = pSelectedContacts
          ? pSelectedContacts
          : getSelectedContacts();
        let selectedContactIds = selectedContacts.map((contact) => contact.id);
        contacts = contacts.filter(
          (contact) => !selectedContactIds.includes(contact.id)
        );

        selectedContacts = contacts.filter((contact) => contact.selected);

        renderContacts();
        selectedContacts = getSelectedContacts();
        updateNumberOfSelectedContacts(selectedContacts.length);
        showHideTableHead(selectedContacts);

        await deleteContacts(selectedContactIds);
      }

      function onCheckboxChange(e) {
        let selectedContactId = parseInt(e.currentTarget.value);
        let selectedContact = contacts.find(
          (contact) => contact.id === selectedContactId
        );
        if (e.currentTarget.checked) {
          e.currentTarget.closest(".contactRow").classList.add("selected");

          if (selectedContact) {
            selectedContact.selected = true;
          }
        } else {
          e.currentTarget.closest(".contactRow").classList.remove("selected");

          if (selectedContact) {
            selectedContact.selected = false;
          }
        }
        let selectedContacts = contacts.filter((contact) => contact.selected);

        showHideTableHead(selectedContacts);

        updateNumberOfSelectedContacts(selectedContacts.length);
      }

      function showHideTableHead(selectedContacts) {
        if (selectedContacts.length > 0) {
          document.querySelector(".tableHead").classList.add("hide");
          document.querySelector(".actionsBar").classList.add("active");
        } else {
          document.querySelector(".tableHead").classList.remove("hide");
          document.querySelector(".actionsBar").classList.remove("active");
        }
      }

      function updateNumberOfSelectedContacts(totalSelectedContacts) {
        document.querySelector(".numberOfSelectedContacts").innerHTML =
          totalSelectedContacts;
      }

      function renderContact() {
        let tableBody = document.querySelector(".tableBody");
        let tableRowsHTML = ``;

        contacts.forEach((contact) => {
          tableRowsHTML += `<div onclick="window.location='/pages/contact.html?id=${
            contact.id
          }'" class="tableRow contactRow ${contact.selected ? "selected" : ""}">
                    <div class="column">
                      <div class="avatar">A</div>
                      <div class="checkbox"  onClick="event.stopImmediatePropagation()">
                        <input type="checkbox" ${
                          contact.selected ? "checked" : ""
                        } value="${
            contact.id
          }" onChange="onCheckboxChange(event)" />
                      </div>
                      ${contact.fullName}
                    </div>
                    <div class="column">${contact.email}</div>
                    <div class="column">${contact.phone}</div>
                    <div class="column">${
                      !contact.lables ? "" : contact.lables.join(", ")
                    }</div>
                    <div class="column" style="width: 40px">
                      <div class="actionButtons">
                        <i class="fa fa-trash" onclick="deleteContact(${
                          contact.id
                        }, event)" aria-hidden="true"></i>

                        <i class="fa fa-edit" onclick="editContact(${
                          contact.id
                        }, event)" aria-hidden="true"></i>
                      </div>
                    </div>
                  </div>`;
        });

        tableBody.innerHTML = tableRowsHTML;
      }

      function deleteContact(contactId, event) {
        event.stopImmediatePropagation();
        let contact = contacts.find((contact) => contact.id == contactId);
        if (contact) {
          deleteSelectedContacts([contact]);
        }
      }

      function editContact(contactId, event) {
        event.stopImmediatePropagation();
        window.location = `/pages/contact-editor.html?id=${contactId}`;
      }
    </script>
    <script src="/assets/js/data.js"></script>
  </body>
</html>
